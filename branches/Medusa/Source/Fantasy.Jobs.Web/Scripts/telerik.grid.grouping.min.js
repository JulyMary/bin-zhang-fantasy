(function(d){var b=d.telerik;var a=3;var c=0;b.grouping={};b.grouping.initialize=function(e){d.extend(e,b.grouping.implementation);e.$groupDropClue=d('<div class="t-grouping-dropclue"/>');e.$groupHeader=d("> .t-grouping-header",e.element);b.draganddrop(e.element.id,d.extend({useDragClue:true,draggables:[d(".t-link",e.$groupHeader[0]),d(".t-header:not(.t-group-cell,.t-hierarchy-cell)",e.$header[0])]},b.draganddrop.applyContext(b.draganddrop.grouping,e)));if(e.isAjax()){e.$groupHeader.delegate(".t-button","click",function(f){f.preventDefault();e.unGroup(d(this).parent().text())}).delegate(".t-link","click",function(g){g.preventDefault();var f=e.groupFromTitle(d(this).parent().text());f.order=f.order=="asc"?"desc":"asc";e.group(f.title)})}e.$groupHeader.delegate(".t-group-indicator","mouseenter",function(){e.$currentGroupItem=d(this)}).delegate(".t-group-indicator","mouseleave",function(){e.$currentGroupItem=null});e.$tbody.delegate(".t-grouping-row .t-collapse, .t-grouping-row .t-expand","click",b.stop(function(f){f.preventDefault();var g=d(this).closest("tr");if(d(this).hasClass("t-collapse")){e.collapseGroup(g)}else{e.expandGroup(g)}}))};b.grouping.implementation={columnFromTitle:function(e){return d.grep(this.columns,function(f){return f.title==e})[0]},groupFromTitle:function(e){return d.grep(this.groups,function(f){return f.title==e})[0]},expandGroup:function(e){var f=d(e);var g=f.find(".t-group-cell").length;f.find("~ tr").each(d.proxy(function(j,h){var l=d(h);var k=l.find(".t-group-cell").length;if(k<=g){return false}if(k==g+1&&!l.hasClass("t-detail-row")){l.show();if(l.hasClass("t-grouping-row")&&l.find(".t-icon").hasClass("t-collapse")){this.expandGroup(l)}if(l.hasClass("t-master-row")&&l.find(".t-icon").hasClass("t-minus")){l.next().show()}}},this));f.find(".t-icon").addClass("t-collapse").removeClass("t-expand")},collapseGroup:function(e){var f=d(e);var g=f.find(".t-group-cell").length;f.find("~ tr").each(function(){var i=d(this);var h=i.find(".t-group-cell").length;if(h<=g){return false}i.hide()});f.find(".t-icon").addClass("t-expand").removeClass("t-collapse")},group:function(e,i){if(this.groups.length==0&&this.isAjax()){this.$groupHeader.empty()}var h=d.grep(this.groups,function(k){return k.title==e})[0];if(!h){var j=this.columnFromTitle(e);h={order:"asc",member:j.member,title:e};this.groups.push(h)}if(i>=0){this.groups.splice(d.inArray(h,this.groups),1);this.groups.splice(i,0,h)}this.groupBy=d.map(this.groups,function(k){return k.member+"-"+k.order}).join("~");if(this.isAjax()){var f=this.$groupHeader.find('div:contains("'+e+'")');if(f.length==0){var g=new d.telerik.stringBuilder().cat('<div class="t-group-indicator">').cat('<a href="#" class="t-link"><span class="t-icon" />').cat(e).cat("</a>").cat('<a class="t-button t-state-default"><span class="t-icon t-group-delete" /></a>').cat("</div>").string();f=d(g).appendTo(this.$groupHeader)}if(this.$groupDropClue.is(":visible")){f.insertBefore(this.$groupDropClue)}f.find(".t-link .t-icon").toggleClass("t-arrow-up-small",h.order=="asc").toggleClass("t-arrow-down-small",h.order=="desc");this.ajaxRequest()}else{this.serverRequest()}},unGroup:function(e){var f=this.groupFromTitle(e);this.groups.splice(d.inArray(f,this.groups),1);if(this.groups.length==0){this.$groupHeader.html(this.localization.groupHint)}this.groupBy=d.map(this.groups,function(h){return h.member+"-"+h.order}).join("~");if(this.isAjax()){this.$groupHeader.find('div:contains("'+f.title+'")').remove();this.ajaxRequest()}else{this.serverRequest()}},normalizeColumns:function(f){var e=this.groups.length;var h=f-this.$tbody.parent().find("col").length;if(h==0){return}var i=this.$tbody.parent().add(this.$headerWrap.find("table"));if(d.browser.msie){if(h>0){d(new b.stringBuilder().rep('<col class="t-group-col" />',h).string()).prependTo(i.find("colgroup"));d(new b.stringBuilder().rep('<th class="t-group-cell t-header">&nbsp;</th>',h).string()).insertBefore(i.find("th.t-header:first"))}else{i.find("th:lt("+Math.abs(h)+")").remove().end().find("col:lt("+Math.abs(h)+")").remove()}if(document.documentMode==8){if(this.scrollable){i.css("table-layout","auto")}var j=this;var g=30;i.find("col").css("width",function(){return d(this).is(".t-group-col,.t-hierarchy-col")?g:(d(j.element).width()-e*g-16)/j.columns.length})}}else{i.find("col.t-group-col").remove();d(new b.stringBuilder().rep('<col class="t-group-col" />',e).string()).prependTo(i.find("colgroup"));i.find("th.t-group-cell").remove();d(new b.stringBuilder().rep('<th class="t-group-cell t-header">&nbsp;</th>',e).string()).insertBefore(i.find("th.t-header:first"))}this.$footer.attr("colspan",f)},bindGroup:function(o,f,j,h){var n=this.groups[h];var m=o.Key;var k=d.grep(this.columns,function(i){return n.member==i.member})[0];if(k&&(k.format||k.type=="Date")){m=b.formatString(k.format||"{0:G}",m)}j.cat('<tr class="t-grouping-row">').rep('<td class="t-group-cell"></td>',h).cat('<td colspan="').cat(f-h).cat('"><p class="t-reset"><a class="t-icon t-collapse" href="#"></a>').cat(n.title).cat(": ").cat(m).cat("</p></td></tr>");if(o.HasSubgroups){for(var e=0,g=o.Items.length;e<g;e++){this.bindGroup(o.Items[e],f,j,h+1)}}else{this.bindData(o.Items,j,h+1)}}};d.extend(b.draganddrop,{grouping:{shouldDrag:function(e){if(e.closest(".t-grid-filter, .t-filter").length){return false}if(e.closest(".t-grid")[0]!=this.element){return false}var f=this.columnFromTitle(e.text());if(f&&f.groupable===false){return false}return true},createDragClue:function(e){return e.text()},onDragStart:function(){return false},onDragMove:function(j,n){j.stopPropagation();if(!d.contains(this.element,j.target)||!d(j.target).closest(".t-grouping-header").length||(this.groupFromTitle(n.text())&&n.closest(".t-header").length)){this.$groupDropClue.remove();return"t-denied"}var l=d.map(this.$groupHeader.find(".t-group-indicator"),function(e){var o=d(e);var p=o.offset().left;return{left:p,right:p+o.outerWidth(),$group:o}});var f=d("> .t-grid-toolbar",this.element).outerHeight()+a;if(!l.length){this.$groupDropClue.css({top:f,left:c}).appendTo(this.$groupHeader);return"t-add"}var g=l[0];var k=l[l.length-1];var h=parseInt(g.$group.css("marginLeft"));var m=parseInt(g.$group.css("marginRight"));var i=d.grep(l,function(e){return j.pageX>=e.left-h-m&&j.pageX<=e.right})[0];if(!i&&g&&j.pageX<g.left){i=g}if(i){this.$groupDropClue.css({top:f,left:i.$group.position().left-h+c}).insertBefore(i.$group)}else{this.$groupDropClue.css({top:f,left:k.$group.position().left+k.$group.outerWidth()+m+c}).appendTo(this.$groupHeader)}return"t-add"},onDragCancelled:function(){this.$groupDropClue.remove()},onDrop:function(j,m){var k=d(j.target).closest(".t-grouping-header");var i=m.text();var l=this.groupFromTitle(i);var h=d.inArray(l,this.groups);if(k.length>0){var g=this.$groupHeader.find("div").index(this.$groupDropClue);var f=h-g;if(!l||(this.$groupDropClue.is(":visible")&&f!=0&&f!=-1)){this.group(i,g)}}else{if(m.parent().is(".t-group-indicator")){this.unGroup(i)}else{this.$groupDropClue.remove();return false}}this.$groupDropClue.remove();return true}}})})(jQuery);