(function(b){var a=b.telerik;var c=10;a.draganddrop=function(d,f){if(!(this instanceof arguments.callee)){return new arguments.callee(d,f)}this.hitTestOffset=5;b.extend(this,f);d="."+(d||"draganddrop");var e=f.draggables;b.each(b.isArray(e)?e:[e],b.proxy(function(h,g){b(g).live("mousedown",b.proxy(this.waitForDrag,this)).live("dragstart",a.preventDefault)},this));this.evt={ss:"selectstart"+d,mm:"mousemove"+d,ku:"keyup"+d,mu:"mouseup"+d}};a.draganddrop.applyContext=function(f,e){var d={};b.each(f,function(g){d[g]=b.isFunction(this)?b.proxy(this,e):this});return d};a.draganddrop.prototype={moveClue:function(f){if(!this.useDragClue){this.onDragMove(f,this.$draggedElement);return}this.$dragClue.css({left:f.pageX+c,top:f.pageY+c});var d=this.onDragMove(f,this.$draggedElement,this.$dragClue)||"t-denied";this.$dragClueStatus.className="t-icon t-drag-status "+d},startDrag:function(h){var f=this.hittestCoordinates.left-h.pageX;var d=this.hittestCoordinates.top-h.pageY;var g=Math.sqrt((d*d)+(f*f));if(g>=this.hitTestOffset){b(document).bind(this.evt.ss,function(){return false}).unbind(this.evt.mm);if(this.onDragStart(h,this.$draggedElement)){}if(this.useDragClue){this.$dragClueStatus=b('<span class="t-icon t-drag-status t-denied" />')[0];this.$dragClue=b('<div class="t-header t-drag-clue" />').html(this.createDragClue(this.$draggedElement)).prepend(this.$dragClueStatus).css({left:h.pageX+c,top:h.pageY+c}).appendTo(document.body)}b(document).bind(this.evt.mm,a.stop(this.moveClue,this)).bind(this.evt.ku,a.stop(this.keyboardListener,this));this.dragStarted=true}},removeDragClue:function(){if(this.$dragClue){this.$dragClue.remove();this.$dragClue=null;this.$dragClueStatus=null}},stopDrag:function(d){if(this.dragStarted){var f=this.onDrop(d,this.$draggedElement,this.useDragClue?this.$dragClue:undefined);if(this.useDragClue&&this.$dragClue){if(!f){this.$dragClue.animate(this.$draggedElement.offset(),"fast",b.proxy(this.removeDragClue,this))}else{if(typeof f=="function"){f(b.proxy(this.removeDragClue,this))}else{this.removeDragClue()}}}this.dragStarted=false}b(document).unbind([this.evt.ss,this.evt.mm,this.evt.mu,this.evt.ku].join(" "))},waitForDrag:function(f){var d=b(f.target);if(f.which!==1||!this.shouldDrag(d)){return}this.$draggedElement=d;this.hittestCoordinates={left:f.pageX,top:f.pageY};b(document).bind(this.evt.mm,a.stop(this.startDrag,this)).bind(this.evt.mu,a.stop(this.stopDrag,this));if(this.hitTestOffset==0){this.startDrag(f)}b(document).trigger("mousedown",f);return false},keyboardListener:function(d){if(d.keyCode==27){b(document).unbind([this.evt.ss,this.evt.mm,this.evt.mu,this.evt.ku].join(" "));this.onDragCancelled(d,this.$draggedElement);if(this.useDragClue&&this.$dragClue){this.$dragClue.animate(this.$draggedElement.offset(),"fast",b.proxy(this.removeDragClue,this))}this.dragStarted=false}}}})(jQuery);