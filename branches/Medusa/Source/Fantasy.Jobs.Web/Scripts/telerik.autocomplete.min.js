(function(b){var a=b.telerik;a.autocomplete=function(f,g){b.extend(this,g);var d=b(f);this.$text=d;this.element=f;this.$element=d;this.trigger=new a.list.trigger(this);this.trigger.change=function(){var j=this.component.text();var i=this.component.previousValue;if(i==undefined||j!=i){a.trigger(this.component.element,"valueChange",{value:j})}this.component.previousValue=j};this.loader=new a.list.loader(this);this.loader.showBusy=function(){this.busyTimeout=setTimeout(b.proxy(function(){this.component.$element.addClass("t-loading")},this),100)};this.loader.hideBusy=function(){clearTimeout(this.busyTimeout);this.component.$element.removeClass("t-loading")};this.filtering=new a.list.filtering(this);this.filtering.autoFill=function(r,m){if(r.autoFill&&(r.lastKeyCode!=8&&r.lastKeyCode!=46)){var o=r.$text[0];var u=o.value;var q=r.separator;var k=a.caretPos(o);var p=q?a.lastIndexOf(u.substring(0,k),q):-1;var n=p!=-1?p+q.length:0;var s=u.substring(n,k);var i=m.toLowerCase().indexOf(s.toLowerCase());if(i!=-1){var t=m.substring(i+s.length);var j=e(o,q);var l=u.split(q);l[j]=s+t;o.value=l.join(q)+(r.multiple&&j!=0&&j==l.length-1?q:"");a.list.selection(o,k,k+t.length)}}};this.filtering.multiple=b.proxy(function(i){if(this.multiple){i=i.split(this.separator);i=i[e(this.$text[0],this.separator)]}return i},this);this.dropDown=new a.dropDown({outerHeight:d.outerHeight(),outerWidth:d.outerWidth(),zIndex:a.list.getZIndex(d),attr:this.dropDownAttr,effects:this.effects,onOpen:b.proxy(function(){var i=this.dropDown;var j=d.offset();i.position(j.top,j.left);if(!i.outerHeight){i.outerHeight=d.outerHeight()}if(!i.outerWidth){i.outerWidth=d.outerWidth();i.$element.css("width",i.outerWidth-2)}return true},this),onClick:b.proxy(function(i){this.select(i.item);this.trigger.change();this.trigger.close()},this)});this.fill=function(p){function o(r){var q=r.highlightFirst?l.$items.first():null;if(q){q.addClass("t-state-selected")}}var n=this.loader;var l=this.dropDown;var i=this.minChars;var m=this.text();var j=m.length;if(!l.$items&&!n.ajaxError){if(n.isAjax()&&j>=i){var k={};k[this.queryString.text]=m;n.ajaxRequest(function(q){this.data=q;l.dataBind(q);o(this);a.trigger(this.element,"dataBound");if(p){p()}},{data:k})}else{l.dataBind(this.data);o(this);if(p){p()}}}};this.text=function(i){return this.$text.val(i)};this.value=function(){return this.text.apply(this,arguments)};this.select=function(j){var n=this.highlight(j);if(n==-1){return n}var m=this.filteredDataIndexes;var q=(m&&m.length)>0?m[n]:n;var j=this.data[q];var i=j.Text?j.Text:j;var l=i;if(this.multiple){var o=this.$element;var p=this.separator;var k=e(o[0],p);l=o.val().split(p);l[k]=i;l=l.join(p)+(k==l.length-1?p:"")}this.text(l)};this.previousValue=this.value();a.list.common.call(this);a.list.filters.call(this);a.bind(this,{dataBinding:this.onDataBinding,dataBound:this.onDataBound,error:this.onError,open:this.onOpen,close:this.onClose,valueChange:this.onChange,load:this.onLoad});d.bind({focus:b.proxy(function(i){i.stopPropagation()},this),keydown:b.proxy(c,this),keypress:b.proxy(function(j){var i=j.keyCode||j.charCode;if(i==0||b.inArray(i,a.list.keycodes)!=-1){return true}h(this)},this)});b(document).bind("mousedown",b.proxy(function(i){var j=this.dropDown.$element.parent();if((j.length>0)&&!b.contains(f,i.target)&&!b.contains(j[0],i.target)){this.trigger.change();this.trigger.close()}},this));function e(j,i){return j.value.substring(0,a.caretPos(j)).split(i).length-1}function h(i){clearTimeout(i.timeout);i.timeout=setTimeout(function(){i.filtering.filter(i)},i.delay)}function c(o){var j=this.trigger;var p=this.dropDown;var m=o.keyCode||o.which;this.lastKeyCode=m;if(!o.shiftKey&&m>36&&m<41&&m!=37&&m!=39){o.preventDefault();if(p.isOpened()){if(!p.$items){this.fill()}var l=p.$items;var k=l.filter(".t-state-selected:first");var n=[];if(m==38){var s=k.prev();n=s.length?s:l.last()}else{if(m==40){var r=k.next();n=r.length?r:l.first()}}if(n.length){var i=n[0];this.highlight(i);p.scrollTo(i);this.filtering.autoFill(this,n.text())}}}if(m==8||m==46){var t=this.$element;if(t.val()!=""){h(this)}setTimeout(b.proxy(function(){if(t.val()==""){j.close()}},this),0)}if(m==13){if(p.$items.length){var q=p.$items.filter(".t-state-selected:first");if(p.isOpened()){o.preventDefault()}if(q.length>0){this.select(q[0]);j.change();j.close();a.list.moveToEnd(this.element)}}}if(m==27||m==9){j.change();j.close()}}};b.fn.tAutoComplete=function(c){return a.create(this,{name:"tAutoComplete",init:function(d,e){return new a.autocomplete(d,e)},options:c})};b.fn.tAutoComplete.defaults={effects:a.fx.slide.defaults(),filter:1,delay:200,minChars:1,cache:true,autoFill:false,highlightFirst:false,queryString:{text:"text"},multiple:false,separator:", "}})(jQuery);